<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rechnung {{rechnung.nummer}} - {{firma.name}}</title>
    <style>
        /* Professional IT Consulting Invoice - Print-First Design */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #ffffff;
            color: #2c3e50;
            line-height: 1.6;
            font-size: 12px;
        }

        .container {
            max-width: 210mm;
            margin: 0 auto;
            padding: 20mm;
            background: white;
            min-height: 297mm;
        }

        /* Typography Hierarchy */
        h1 {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        h2 {
            font-size: 14px;
            font-weight: 600;
            color: #0066cc;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 5px;
        }

        .code-text {
            font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            background: #f8f9fa;
            padding: 2px 4px;
            border: 1px solid #dee2e6;
            border-radius: 3px;
        }

        /* Header Section */
        .header {
            display: table;
            width: 100%;
            margin-bottom: 30mm;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 10mm;
        }

        .company-info {
            display: table-cell;
            width: 60%;
            vertical-align: top;
        }

        .invoice-logo {
            display: table-cell;
            width: 40%;
            vertical-align: top;
            text-align: right;
        }

        .company-tagline {
            color: #0066cc;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .company-details {
            font-size: 11px;
            line-height: 1.4;
            color: #6c757d;
        }

        /* Invoice Metadata Section */
        .invoice-meta {
            display: table;
            width: 100%;
            margin-bottom: 20mm;
        }

        .client-info, .invoice-info {
            display: table-cell;
            width: 50%;
            vertical-align: top;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }

        .client-info {
            margin-right: 10mm;
        }

        .invoice-number {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }

        .sla-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .sla-gold {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .sla-silver {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #c6c8ca;
        }

        .sla-bronze {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Professional Service Positions Table */
        .positions-section {
            margin-bottom: 20mm;
        }

        .positions-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            border: 1px solid #dee2e6;
        }

        .positions-table th {
            background: #2c3e50;
            color: white;
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid #2c3e50;
        }

        .positions-table td {
            padding: 10px 8px;
            border: 1px solid #dee2e6;
            vertical-align: top;
        }

        .positions-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .phase-cell {
            font-weight: 600;
            color: #0066cc;
            font-size: 10px;
            text-transform: uppercase;
        }

        .tech-tags {
            margin-top: 5px;
        }

        .tech-tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            margin: 1px 2px 1px 0;
            border: 1px solid #bbdefb;
        }

        .remote-badge {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: 500;
            border: 1px solid;
        }

        .remote-remote {
            background: #e8f5e8;
            color: #2e7d32;
            border-color: #c8e6c9;
        }

        .remote-onsite {
            background: #fff3e0;
            color: #f57c00;
            border-color: #ffcc02;
        }

        .remote-hybrid {
            background: #f3e5f5;
            color: #7b1fa2;
            border-color: #ce93d8;
        }

        .ticket-ref {
            font-family: 'Courier New', monospace;
            font-size: 9px;
            color: #0066cc;
            text-decoration: none;
        }

        .ticket-ref:hover {
            text-decoration: underline;
        }

        /* Change Requests Section */
        .change-requests {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-left: 4px solid #ffb400;
            padding: 15px;
            margin-bottom: 15mm;
        }

        .cr-item {
            display: table;
            width: 100%;
            padding: 8px 0;
            border-bottom: 1px solid #ffeaa7;
        }

        .cr-item:last-child {
            border-bottom: none;
        }

        .cr-number {
            display: table-cell;
            width: 15%;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .cr-description {
            display: table-cell;
            width: 55%;
        }

        .cr-hours {
            display: table-cell;
            width: 15%;
            text-align: center;
            font-weight: bold;
        }

        .cr-status {
            display: table-cell;
            width: 15%;
            text-align: center;
        }

        .cr-status-approved {
            background: #d4edda;
            color: #155724;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            border: 1px solid #c3e6cb;
        }

        /* Summary and Totals */
        .summary-section {
            display: table;
            width: 100%;
            margin-bottom: 15mm;
        }

        .hours-breakdown {
            display: table-cell;
            width: 50%;
            background: #f8f9fa;
            padding: 15px;
            border: 1px solid #dee2e6;
            margin-right: 5mm;
        }

        .total-section {
            display: table-cell;
            width: 50%;
            background: #2c3e50;
            color: white;
            padding: 15px;
            border: 1px solid #2c3e50;
        }

        .hours-item {
            display: table;
            width: 100%;
            margin-bottom: 5px;
            font-size: 11px;
        }

        .hours-label {
            display: table-cell;
            width: 70%;
        }

        .hours-value {
            display: table-cell;
            width: 30%;
            text-align: right;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .total-line {
            display: table;
            width: 100%;
            margin-bottom: 8px;
        }

        .total-label {
            display: table-cell;
            width: 60%;
        }

        .total-value {
            display: table-cell;
            width: 40%;
            text-align: right;
            font-family: 'Courier New', monospace;
        }

        .total-line.final {
            font-size: 16px;
            font-weight: bold;
            border-top: 2px solid #0066cc;
            padding-top: 10px;
            margin-top: 10px;
        }

        /* Payment Information */
        .payment-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15mm;
            margin-bottom: 15mm;
        }

        .payment-methods {
            display: table;
            width: 100%;
        }

        .payment-method {
            display: table-cell;
            width: 33.33%;
            padding: 0 10mm 0 0;
            vertical-align: top;
        }

        .payment-method:last-child {
            padding-right: 0;
        }

        .payment-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 11px;
            text-transform: uppercase;
        }

        .iban-display {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            background: white;
            padding: 5px;
            border: 1px solid #dee2e6;
            margin: 3px 0;
        }

        /* Technical Information Grid */
        .technical-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15mm;
            margin-bottom: 15mm;
        }

        .info-grid {
            display: table;
            width: 100%;
        }

        .info-column {
            display: table-cell;
            width: 50%;
            padding-right: 15mm;
            vertical-align: top;
        }

        .info-column:last-child {
            padding-right: 0;
        }

        .info-item {
            margin-bottom: 10px;
            font-size: 11px;
        }

        .info-label {
            font-weight: 600;
            color: #0066cc;
            display: block;
            margin-bottom: 2px;
            font-size: 10px;
            text-transform: uppercase;
        }

        /* Footer */
        .footer {
            margin-top: 20mm;
            padding-top: 10mm;
            border-top: 1px solid #dee2e6;
            font-size: 10px;
            color: #6c757d;
        }

        .compliance-grid {
            display: table;
            width: 100%;
            margin-bottom: 10mm;
        }

        .compliance-item {
            display: table-cell;
            width: 33.33%;
            padding-right: 10mm;
            vertical-align: top;
        }

        .compliance-item:last-child {
            padding-right: 0;
        }

        .footer-note {
            text-align: center;
            padding-top: 10mm;
            border-top: 1px solid #dee2e6;
            font-style: italic;
        }

        /* Print Optimizations */
        @media print {
            body {
                background: white;
                color: black;
            }
            
            .container {
                box-shadow: none;
                margin: 0;
                padding: 15mm;
            }
            
            .positions-table th {
                background: #2c3e50 !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .total-section {
                background: #2c3e50 !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            * {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            @page {
                size: A4;
                margin: 15mm;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10mm;
            }
            
            .header {
                display: block;
            }
            
            .company-info, .invoice-logo {
                display: block;
                width: 100%;
            }
            
            .invoice-meta {
                display: block;
            }
            
            .client-info, .invoice-info {
                display: block;
                width: 100%;
                margin: 0 0 10mm 0;
            }
            
            .summary-section {
                display: block;
            }
            
            .hours-breakdown, .total-section {
                display: block;
                width: 100%;
                margin: 0 0 10mm 0;
            }
            
            .payment-methods {
                display: block;
            }
            
            .payment-method {
                display: block;
                width: 100%;
                margin-bottom: 10mm;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Professional Header -->
        <header class="header">
            <div class="company-info">
                <h1>{{firma.name}}</h1>
                <div class="company-tagline">{{firma.tagline}}</div>
                <div class="company-details">
                    {{firma.strasse}}<br>
                    {{firma.plz}} {{firma.ort}}, {{firma.land}}<br>
                    Tel: {{firma.telefon}} | E-Mail: {{firma.email}}<br>
                    Web: {{firma.web}} | UID: {{firma.uid}}<br>
                    {{firma.firmenbuch}} | {{firma.gericht}}
                </div>
            </div>
            <div class="invoice-logo">
                <div style="font-size: 10px; color: #6c757d; text-align: right;">
                    IT CONSULTING SERVICES<br>
                    PROFESSIONAL INVOICE
                </div>
            </div>
        </header>

        <!-- Invoice Metadata -->
        <section class="invoice-meta">
            <div class="client-info">
                <h2>Rechnungsempfänger</h2>
                <strong>{{kunde.firma}}</strong><br>
                {{kunde.ansprechpartner}}<br>
                {{#if kunde.abteilung}}{{kunde.abteilung}}<br>{{/if}}
                {{kunde.strasse}}<br>
                {{kunde.plz}} {{kunde.ort}}, {{kunde.land}}<br>
                {{#if kunde.uid}}UID: {{kunde.uid}}<br>{{/if}}
                <br>
                <span class="code-text">Projekt: {{kunde.projekt_ref}}</span><br>
                <span class="code-text">Kostenstelle: {{kunde.kostenstelle}}</span>
            </div>

            <div class="invoice-info">
                <h2>Rechnungsdetails</h2>
                <div class="invoice-number">{{rechnung.nummer}}</div>
                <strong>Rechnungsdatum:</strong> {{rechnung.datum}}<br>
                <strong>Leistungszeitraum:</strong> {{rechnung.leistungszeitraum}}<br>
                <strong>Zahlungsziel:</strong> {{rechnung.zahlungsziel}}<br>
                <strong>Betreff:</strong> {{rechnung.betreff}}<br>
                <br>
                <span class="sla-badge sla-{{rechnung.sla_level|lower}}">{{rechnung.sla_level}} SLA</span><br>
                <span class="code-text">Contract: {{rechnung.contract_ref}}</span>
            </div>
        </section>

        <!-- Professional Service Positions -->
        <section class="positions-section">
            <h2>IT-Dienstleistungen und Projektphasen</h2>
            <table class="positions-table">
                <thead>
                    <tr>
                        <th style="width: 15%">Phase / Tickets</th>
                        <th style="width: 30%">Servicebeschreibung</th>
                        <th style="width: 12%">Entwickler</th>
                        <th style="width: 8%">Std.</th>
                        <th style="width: 10%">€/Std.</th>
                        <th style="width: 8%">Modus</th>
                        <th style="width: 10%">Technologien</th>
                        <th style="width: 7%">Gesamt €</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each positionen}}
                    <tr>
                        <td>
                            <div class="phase-cell">{{phase}}</div>
                            {{#each tickets}}
                            <a href="https://jira.company.com/browse/{{this}}" class="ticket-ref" target="_blank">{{this}}</a>{{#unless @last}}<br>{{/unless}}
                            {{/each}}
                        </td>
                        <td>
                            {{beschreibung}}
                            <div class="tech-tags">
                                {{#each technologien}}
                                <span class="tech-tag">{{this}}</span>
                                {{/each}}
                            </div>
                        </td>
                        <td>{{entwickler}}</td>
                        <td style="text-align: center; font-family: 'Courier New', monospace;">{{stunden}}</td>
                        <td style="text-align: right; font-family: 'Courier New', monospace;">€ {{stundensatz}}</td>
                        <td><span class="remote-badge remote-{{remote_onsite}}">{{remote_onsite}}</span></td>
                        <td>
                            {{#each technologien}}
                            <div style="font-size: 9px;">{{this}}</div>
                            {{/each}}
                        </td>
                        <td style="text-align: right; font-family: 'Courier New', monospace;"><strong>€ {{gesamt}}</strong></td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </section>

        <!-- Change Requests (if applicable) -->
        {{#if change_requests}}
        <section class="change-requests">
            <h2 style="color: #856404;">Change Request Management</h2>
            {{#each change_requests}}
            <div class="cr-item">
                <div class="cr-number">{{cr_nummer}}</div>
                <div class="cr-description">
                    {{beschreibung}}<br>
                    <small>Genehmigt von: {{genehmigt_von}} am {{datum}}</small>
                </div>
                <div class="cr-hours">{{zusatz_stunden}} Std.</div>
                <div class="cr-status">
                    <span class="cr-status-approved">{{status}}</span>
                </div>
            </div>
            {{/each}}
        </section>
        {{/if}}

        <!-- Summary and Totals -->
        <section class="summary-section">
            <div class="hours-breakdown">
                <h2>Stunden-Aufschlüsselung</h2>
                <div class="hours-item">
                    <div class="hours-label">Remote Work:</div>
                    <div class="hours-value">{{zusammenfassung.stunden_remote}} Std.</div>
                </div>
                <div class="hours-item">
                    <div class="hours-label">Onsite Work:</div>
                    <div class="hours-value">{{zusammenfassung.stunden_onsite}} Std.</div>
                </div>
                <div class="hours-item">
                    <div class="hours-label">Hybrid Work:</div>
                    <div class="hours-value">{{zusammenfassung.stunden_hybrid}} Std.</div>
                </div>
                <div class="hours-item" style="border-top: 1px solid #dee2e6; padding-top: 8px; margin-top: 8px;">
                    <div class="hours-label"><strong>Gesamtstunden:</strong></div>
                    <div class="hours-value"><strong>{{zusammenfassung.stunden_gesamt}} Std.</strong></div>
                </div>
            </div>

            <div class="total-section">
                <div class="total-line">
                    <div class="total-label">Nettosumme:</div>
                    <div class="total-value">€ {{zusammenfassung.summe_netto}}</div>
                </div>
                {{#unless zusammenfassung.reverse_charge}}
                <div class="total-line">
                    <div class="total-label">USt {{zusammenfassung.ust_satz}}%:</div>
                    <div class="total-value">€ {{zusammenfassung.ust_betrag}}</div>
                </div>
                {{/unless}}
                <div class="total-line final">
                    <div class="total-label">Gesamtsumme:</div>
                    <div class="total-value">€ {{zusammenfassung.summe_brutto}}</div>
                </div>
                {{#if zusammenfassung.reverse_charge}}
                <div style="margin-top: 10px; font-size: 11px; color: #0066cc; border-top: 1px solid #0066cc; padding-top: 8px;">
                    ⚠️ Reverse Charge Verfahren<br>
                    Steuerschuldnerschaft des Leistungsempfängers
                </div>
                {{/if}}
            </div>
        </section>

        <!-- Payment Information -->
        <section class="payment-section">
            <h2>Zahlungsinformationen</h2>
            <div class="payment-methods">
                <div class="payment-method">
                    <div class="payment-title">Banküberweisung (Standard)</div>
                    <strong>{{firma.bank}}</strong><br>
                    <div class="iban-display">{{firma.iban}}</div>
                    <div class="iban-display">BIC: {{firma.bic}}</div>
                </div>
                <div class="payment-method">
                    <div class="payment-title">SEPA-Lastschrift</div>
                    <small>Nur bei Wartungsverträgen</small><br>
                    <div class="code-text">Gläubiger-ID auf Anfrage</div>
                </div>
                <div class="payment-method">
                    <div class="payment-title">Zahlungskonditionen</div>
                    <strong>Zahlungsziel:</strong> {{rechnung.zahlungsziel}}<br>
                    <strong>Skonto:</strong> 2% bei Zahlung binnen 10 Tagen<br>
                    <strong>Verzugszinsen:</strong> 9,2% p.a.
                </div>
            </div>
        </section>

        <!-- Technical Project Information -->
        <section class="technical-info">
            <h2>Technische Projektinformationen</h2>
            <div class="info-grid">
                <div class="info-column">
                    <div class="info-item">
                        <span class="info-label">SLA Response Time:</span>
                        {{zusatzinfo.sla_response}}
                    </div>
                    <div class="info-item">
                        <span class="info-label">Git Repositories:</span>
                        {{#each zusatzinfo.git_repos}}
                        <div class="code-text">{{this}}</div>
                        {{/each}}
                    </div>
                    <div class="info-item">
                        <span class="info-label">Deployment Status:</span>
                        {{zusatzinfo.deployment}}
                    </div>
                </div>
                <div class="info-column">
                    <div class="info-item">
                        <span class="info-label">NDA Reference:</span>
                        {{zusatzinfo.nda}}
                    </div>
                    <div class="info-item">
                        <span class="info-label">DSGVO Compliance:</span>
                        {{zusatzinfo.dsgvo}}
                    </div>
                    <div class="info-item">
                        <span class="info-label">Next Sprint:</span>
                        {{zusatzinfo.next_sprint}}
                    </div>
                </div>
            </div>
        </section>

        <!-- Professional Footer -->
        <footer class="footer">
            <div class="compliance-grid">
                <div class="compliance-item">
                    <strong>Geschäftsführung:</strong><br>
                    {{firma.geschaeftsfuehrer}}<br>
                    <strong>ISO 27001:</strong><br>
                    {{firma.iso27001}}
                </div>
                <div class="compliance-item">
                    <strong>Rechtliche Hinweise:</strong><br>
                    Gerichtsstand: {{firma.gericht}}<br>
                    Es gilt österreichisches Recht.<br>
                    Aufbewahrungspflicht: 7 Jahre
                </div>
                <div class="compliance-item">
                    <strong>Support & Service:</strong><br>
                    E-Mail: {{firma.email}}<br>
                    Web: {{firma.web}}<br>
                    Support-Hotline nach SLA
                </div>
            </div>
            
            <div class="footer-note">
                Diese Rechnung wurde elektronisch erstellt und ist ohne Unterschrift gültig.<br>
                Alle Angaben entsprechen den Bestimmungen des UStG §11 und sind rechtsgültig für österreichische Geschäftstransaktionen.
            </div>
        </footer>
    </div>
</body>
</html>