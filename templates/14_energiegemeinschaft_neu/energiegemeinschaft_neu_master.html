<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EEG-Energieabrechnung - {{rechnung.nummer}}</title>
    <style>
        /* Professional Energy Sector Design - Print Optimized */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 11pt;
            line-height: 1.4;
            color: #2d3748;
            background: #fefefe;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Technical Documentation Layout */
        .invoice-container {
            width: 100%;
            background: white;
        }
        
        /* Professional Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #2D8A3E;
        }
        
        .eeg-info {
            flex: 1;
        }
        
        .eeg-info h1 {
            font-size: 16pt;
            font-weight: bold;
            color: #2D8A3E;
            margin-bottom: 8px;
        }
        
        .eeg-info .registration {
            font-size: 10pt;
            color: #6b7280;
            font-weight: bold;
            margin-bottom: 12px;
        }
        
        .contact-info {
            font-size: 10pt;
            line-height: 1.3;
        }
        
        .logo-area {
            width: 150px;
            height: 60px;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            font-size: 9pt;
            color: #6b7280;
        }
        
        /* Invoice Meta Information */
        .invoice-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .meta-left, .meta-right {
            width: 48%;
        }
        
        .meta-title {
            font-weight: bold;
            color: #2D8A3E;
            margin-bottom: 8px;
            font-size: 12pt;
        }
        
        .member-info, .invoice-info {
            background: #f8fafc;
            padding: 15px;
            border: 1px solid #e2e8f0;
        }
        
        .member-info p, .invoice-info p {
            margin-bottom: 4px;
        }
        
        .member-number {
            font-weight: bold;
            color: #1E88E5;
        }
        
        /* Energy Balance Section */
        .energy-balance {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 14pt;
            font-weight: bold;
            color: #2D8A3E;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .balance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .balance-card {
            background: #f8fafc;
            padding: 15px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }
        
        .balance-card .label {
            font-size: 10pt;
            color: #6b7280;
            margin-bottom: 5px;
        }
        
        .balance-card .value {
            font-size: 14pt;
            font-weight: bold;
            color: #1E88E5;
        }
        
        .balance-card .unit {
            font-size: 9pt;
            color: #6b7280;
        }
        
        /* Professional Table Styling */
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        
        .invoice-table th {
            background: #2D8A3E;
            color: white;
            font-weight: bold;
            padding: 12px 8px;
            text-align: left;
            font-size: 10pt;
        }
        
        .invoice-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 10pt;
        }
        
        .invoice-table tbody tr:nth-child(even) {
            background: #f8fafc;
        }
        
        .amount {
            text-align: right;
            font-family: 'Courier New', monospace;
        }
        
        /* Summary Section */
        .summary {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 30px;
        }
        
        .summary-table {
            width: 300px;
            border-collapse: collapse;
        }
        
        .summary-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .summary-table .label {
            font-weight: bold;
        }
        
        .summary-table .total-row {
            background: #2D8A3E;
            color: white;
            font-weight: bold;
        }
        
        /* Legal and Compliance Information */
        .compliance-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
        }
        
        .compliance-title {
            font-weight: bold;
            color: #2D8A3E;
            margin-bottom: 10px;
        }
        
        .compliance-text {
            font-size: 9pt;
            line-height: 1.3;
            color: #4a5568;
        }
        
        /* Payment Information */
        .payment-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .payment-info {
            flex: 1;
            margin-right: 30px;
        }
        
        .qr-code {
            width: 100px;
            height: 100px;
            border: 1px solid #e2e8f0;
            display: block;
            background: #f8fafc;
        }
        
        /* Technical Details */
        .technical-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .tech-card {
            background: #f8fafc;
            padding: 15px;
            border: 1px solid #e2e8f0;
        }
        
        .tech-title {
            font-weight: bold;
            color: #1E88E5;
            margin-bottom: 8px;
            font-size: 10pt;
        }
        
        .tech-value {
            font-size: 10pt;
            margin-bottom: 4px;
        }
        
        /* Footer */
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            font-size: 9pt;
            color: #6b7280;
            text-align: center;
        }
        
        /* Professional Print Optimization */
        @media print {
            /* A4 Page Setup with optimized margins */
            @page {
                size: A4;
                margin: 12mm 15mm 15mm 15mm; /* top, right, bottom, left */
            }
            
            body {
                margin: 0;
                padding: 0;
                font-size: 10pt;
                line-height: 1.3;
                background: white;
                color: black;
            }
            
            .invoice-container {
                max-width: none;
                width: 100%;
                margin: 0;
                padding: 0;
            }
            
            /* Header optimization */
            .header {
                margin-bottom: 15mm;
                break-after: avoid;
                page-break-after: avoid;
            }
            
            /* Energy Balance - Keep on one line */
            .energy-balance {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 15mm;
            }
            
            .balance-grid {
                display: flex !important;
                flex-wrap: nowrap !important;
                gap: 10mm;
                justify-content: space-between;
            }
            
            .balance-card {
                flex: 1;
                min-width: 0;
                background: white !important;
                border: 1px solid #000 !important;
                padding: 8mm;
                text-align: center;
                break-inside: avoid;
            }
            
            .balance-card .label {
                font-size: 9pt;
                color: black !important;
                margin-bottom: 2mm;
            }
            
            .balance-card .value {
                font-size: 12pt;
                font-weight: bold;
                color: black !important;
            }
            
            .balance-card .unit {
                font-size: 8pt;
                color: black !important;
            }
            
            /* Section titles */
            .section-title {
                break-after: avoid;
                page-break-after: avoid;
                margin-bottom: 8mm;
                margin-top: 10mm;
            }
            
            /* Invoice meta sections */
            .invoice-meta {
                margin-bottom: 15mm;
                break-inside: avoid;
            }
            
            /* Table optimization */
            .invoice-table {
                break-inside: auto;
                margin-bottom: 10mm;
            }
            
            .invoice-table thead {
                display: table-header-group;
            }
            
            .invoice-table tr {
                break-inside: avoid;
                page-break-inside: avoid;
            }
            
            .invoice-table th {
                background: white !important;
                color: black !important;
                border: 1px solid #000 !important;
                padding: 4mm 3mm;
                font-size: 9pt;
            }
            
            .invoice-table td {
                padding: 3mm;
                font-size: 9pt;
                border: 1px solid #000 !important;
            }
            
            /* Technical details compact layout */
            .technical-details {
                break-inside: avoid;
            }
            
            .tech-card {
                margin-bottom: 5mm;
                background: white !important;
                border: 1px solid #ccc !important;
            }
            
            /* Compact spacing for print */
            .member-info, .invoice-info {
                background: white !important;
                border: 1px solid #000 !important;
                padding: 8mm;
            }
            
            /* Header-Content binding */
            h1, h2, h3, h4 {
                break-after: avoid;
                orphans: 3;
                widows: 3;
            }
            
            /* Prevent orphans and widows */
            p, li, div {
                orphans: 2;
                widows: 2;
            }
            
            /* Smart meter section */
            .smart-meter {
                break-inside: avoid;
            }
            
            /* Hide non-essential elements for print */
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <!-- Professional Header -->
        <header class="header">
            <div class="eeg-info">
                <h1>{{eeg.name}}</h1>
                <div class="registration">E-Control Registrierung: {{eeg.econtrol_nummer}}</div>
                <div class="contact-info">
                    {{eeg.strasse}}<br>
                    {{eeg.plz}} {{eeg.ort}}, {{eeg.land}}<br>
                    Tel: {{eeg.telefon}} | E-Mail: {{eeg.email}}<br>
                    Web: {{eeg.web}}<br>
                    {{#if eeg.uid}}UID: {{eeg.uid}}{{/if}}
                </div>
            </div>
            <div class="logo-area">
                <img src="placeholders/logo_rectangle.png" alt="EEG Logo" width="150" height="60" style="max-width: 100%; height: auto;">
            </div>
        </header>

        <!-- Invoice Meta Information -->
        <div class="invoice-meta">
            <div class="meta-left">
                <div class="meta-title">Mitgliedsdaten</div>
                <div class="member-info">
                    <p><strong class="member-number">Mitglied-Nr.: {{mitglied.nummer}}</strong></p>
                    <p>{{mitglied.name}}</p>
                    <p>{{mitglied.strasse}}</p>
                    <p>{{mitglied.plz}} {{mitglied.ort}}</p>
                    <p>Anlagentyp: <strong>{{mitglied.anlagentyp}}</strong></p>
                    <p>Beitritt: {{mitglied.beitrittsdatum}}</p>
                </div>
            </div>
            <div class="meta-right">
                <div class="meta-title">Abrechnungsdaten</div>
                <div class="invoice-info">
                    <p><strong>Rechnung Nr.: {{rechnung.nummer}}</strong></p>
                    <p>Rechnungsdatum: {{rechnung.datum}}</p>
                    <p>Abrechnungszeitraum: {{rechnung.abrechnungszeitraum}}</p>
                    <p>Zahlbar bis: {{rechnung.zahlungsziel}}</p>
                    <p>Zahlungsart: SEPA-Überweisung</p>
                </div>
            </div>
        </div>

        <!-- Energy Balance Overview -->
        <section class="energy-balance">
            <h2 class="section-title">Energiebilanz nach ElWOG §16e</h2>
            <div class="balance-grid">
                <div class="balance-card">
                    <div class="label">Gesamtverbrauch</div>
                    <div class="value">{{energieabrechnung.verbrauch_kwh}}</div>
                    <div class="unit">kWh</div>
                </div>
                <div class="balance-card">
                    <div class="label">EEG-Bezug</div>
                    <div class="value">{{energieabrechnung.bezug_eeg_kwh}}</div>
                    <div class="unit">kWh</div>
                </div>
                <div class="balance-card">
                    <div class="label">Autarkiegrad</div>
                    <div class="value">{{energieabrechnung.autarkiegrad_prozent}}</div>
                    <div class="unit">%</div>
                </div>
            </div>
        </section>

        <!-- Detailed Invoice Items -->
        <section class="invoice-items">
            <h2 class="section-title">Leistungen und Entgelte</h2>
            <table class="invoice-table">
                <thead>
                    <tr>
                        <th style="width: 50%">Beschreibung</th>
                        <th style="width: 15%">Menge</th>
                        <th style="width: 15%">Einzelpreis</th>
                        <th style="width: 10%">USt</th>
                        <th style="width: 10%">Gesamt</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each positionen}}
                    <tr>
                        <td>{{beschreibung}}</td>
                        <td class="amount">
                            {{#if kwh}}{{kwh}} kWh{{else}}{{#if menge}}{{menge}}{{/if}}{{/if}}
                        </td>
                        <td class="amount">
                            {{#if preis_pro_kwh}}€ {{preis_pro_kwh}}{{else}}{{#if einzelpreis}}€ {{einzelpreis}}{{/if}}{{/if}}
                        </td>
                        <td class="amount">{{steuersatz}}%</td>
                        <td class="amount">€ {{gesamt}}</td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </section>

        <!-- Summary Section -->
        <div class="summary">
            <table class="summary-table">
                <tr>
                    <td class="label">Summe netto:</td>
                    <td class="amount">€ {{zusammenfassung.summe_netto}}</td>
                </tr>
                <tr>
                    <td class="label">Umsatzsteuer 10%:</td>
                    <td class="amount">€ {{zusammenfassung.ust_10}}</td>
                </tr>
                <tr>
                    <td class="label">Umsatzsteuer 20%:</td>
                    <td class="amount">€ {{zusammenfassung.ust_20}}</td>
                </tr>
                <tr class="total-row">
                    <td class="label">Rechnungsbetrag:</td>
                    <td class="amount">€ {{zusammenfassung.summe_brutto}}</td>
                </tr>
            </table>
        </div>

        <!-- Technical Energy Details -->
        <section class="technical-details">
            <div class="tech-card">
                <div class="tech-title">Smart Meter Daten</div>
                <div class="tech-value">Zählpunkt-ID: AT0033000000000000001234567890</div>
                <div class="tech-value">Ablesung: {{rechnung.datum}}</div>
                <div class="tech-value">Messperiode: 15-Minuten Intervalle</div>
                <div class="tech-value">Datenbereitstellung: T+1 (24h)</div>
            </div>
            <div class="tech-card">
                <div class="tech-title">Nachhaltigkeits-Impact</div>
                <div class="tech-value">CO2-Einsparung: {{energieabrechnung.co2_einsparung_kg}} kg</div>
                <div class="tech-value">Lokale Wertschöpfung: €{{zusammenfassung.ersparnis_vs_vollpreis}}</div>
                <div class="tech-value">EEG-Mitglieder: {{eeg.mitglieder_anzahl}}</div>
                <div class="tech-value">Installierte Leistung: {{eeg.installierte_leistung_kwp}} kWp</div>
            </div>
        </section>

        <!-- Compliance and Legal Information -->
        <section class="compliance-section">
            <div class="compliance-title">Rechtliche Hinweise nach ElWOG 2010</div>
            <div class="compliance-text">
                Diese Abrechnung erfolgt nach § 16a ff ElWOG 2010 für Erneuerbare-Energie-Gemeinschaften. 
                Die separate Ausweisung von Gemeinschaftsenergie und Netzbezug entspricht § 16e Abs 3 ElWOG. 
                Reduzierte Netzentgelte gelten für den lokalen EEG-Anteil gemäß aktueller E-Control Verordnung.
                Energiegemeinschaft registriert bei E-Control Austria unter {{eeg.econtrol_nummer}}.
            </div>
        </section>

        <!-- Payment Information -->
        <div class="payment-section">
            <div class="payment-info">
                <div class="meta-title">Zahlungsinformationen</div>
                <p><strong>IBAN:</strong> AT89 1234 5678 9012 3456</p>
                <p><strong>BIC:</strong> BKAUATWW</p>
                <p><strong>Bank:</strong> Bank Austria</p>
                <p><strong>Verwendungszweck:</strong> {{rechnung.nummer}} {{mitglied.nummer}}</p>
                <p><strong>Fällig:</strong> {{rechnung.zahlungsziel}}</p>
            </div>
            <img src="placeholders/qr.png" alt="EPC-QR-Code für SEPA-Überweisung" class="qr-code" width="100" height="100">
        </div>

        <!-- Professional Footer -->
        <footer class="footer">
            <p>{{eeg.name}} | E-Control Registrierung: {{eeg.econtrol_nummer}} | {{eeg.email}}</p>
            <p>Diese Rechnung wurde elektronisch erstellt und ist ohne Unterschrift gültig.</p>
            <p>Aufbewahrungspflicht: 7 Jahre nach Rechnungsstellung gemäß BAO.</p>
        </footer>
    </div>
</body>
</html>